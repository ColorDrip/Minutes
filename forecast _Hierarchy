import pandas as pd
from prophet import Prophet

# Load your dataset
df = pd.read_csv("your_data.csv")

# Ensure Date is datetime
df['Date'] = pd.to_datetime(df['Date'])

# Forecast horizon
future_months = 12

# Store results
all_forecasts = []

# Loop by group
group_cols = ["Country", "FunctionGroup", "SubGroup", "Group3", "JointFamily"]

for keys, group_df in df.groupby(group_cols):
    # Prepare for Prophet
    ts = group_df[['Date', 'Cost']].rename(columns={'Date': 'ds', 'Cost': 'y'})
    
    model = Prophet()
    model.fit(ts)
    
    future = model.make_future_dataframe(periods=future_months, freq='M')
    forecast = model.predict(future)
    
    forecast['Country'], forecast['FunctionGroup'], forecast['SubGroup'], forecast['Group3'], forecast['JointFamily'] = keys
    all_forecasts.append(forecast)

# Combine all forecasts
result = pd.concat(all_forecasts)
result.to_csv("forecast_results.csv", index=False)