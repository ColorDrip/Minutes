import os
import re

def detect_and_rename_onedrive_folder():
    # Step 1: Detect OneDrive folder (personal or business)
    onedrive_path = os.environ.get("OneDrive") or os.environ.get("OneDriveCommercial")

    if not onedrive_path:
        print("âš ï¸ OneDrive folder not found. Make sure OneDrive is configured and running.")
        return

    # Step 2: Try to extract employee ID from folder name (if it contains digits or ID pattern)
    match = re.search(r"(\d{4,})", onedrive_path)  # e.g. look for something like 1234 or employee number
    employee_id = match.group(1) if match else "Unknown"

    print(f"âœ… OneDrive folder detected:")
    print(f"   ğŸ“ Location: {onedrive_path}")
    print(f"   ğŸ†” Employee ID: {employee_id}")

    # Step 3: Check if any subfolder contains 'ABC' and rename it to 'App'
    renamed = False
    for folder_name in os.listdir(onedrive_path):
        folder_path = os.path.join(onedrive_path, folder_name)
        if os.path.isdir(folder_path) and 'abc' in folder_name.lower():
            new_folder_path = os.path.join(onedrive_path, "App")
            os.rename(folder_path, new_folder_path)
            renamed = True
            print(f"ğŸ”„ Renamed folder '{folder_name}' â†’ 'App'")
            break

    if not renamed:
        print("â„¹ï¸ No folder containing 'ABC' found inside OneDrive folder.")

detect_and_rename_onedrive_folder()