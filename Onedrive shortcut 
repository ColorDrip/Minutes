import os

# =======================
# üîß CONFIGURATION
# =======================
SEARCH_KEYWORD = "ABC"       # Text to search for in folder names (case-insensitive)
RENAME_TO = "App"            # New name if renaming is enabled
CHECK_ONLY = True             # ‚úÖ True = only check and list (no rename)
RECURSIVE_SEARCH = True       # ‚úÖ True = search in all subfolders, False = top level only
# =======================


def find_onedrive_path():
    """Detect the local OneDrive path (personal or business)."""
    for var in ("OneDrive", "OneDriveCommercial", "OneDriveConsumer"):
        path = os.environ.get(var)
        if path and os.path.isdir(path):
            return path
    return None


def list_or_rename_folders():
    """List (and optionally rename) folders based on parameters."""
    onedrive_path = find_onedrive_path()
    if not onedrive_path:
        print("‚ùå OneDrive folder not found. Please ensure OneDrive is installed and synced.")
        return

    print(f"‚úÖ OneDrive detected at: {onedrive_path}\n")
    print(f"üîç Searching for folders containing: '{SEARCH_KEYWORD}'")
    print(f"üõ† Mode: {'Check Only' if CHECK_ONLY else 'Rename'}")
    print(f"üîÅ Recursive Search: {'Enabled' if RECURSIVE_SEARCH else 'Top Level Only'}\n")

    matching_folders = []

    # Choose between recursive and top-level search
    if RECURSIVE_SEARCH:
        walker = os.walk(onedrive_path)
    else:
        walker = [(onedrive_path, next(os.walk(onedrive_path))[1], [])]

    for root, dirs, _ in walker:
        for folder_name in dirs:
            if SEARCH_KEYWORD.lower() in folder_name.lower():
                full_path = os.path.join(root, folder_name)
                matching_folders.append(full_path)

                if CHECK_ONLY:
                    print(f"üìÅ Found folder: {full_path}")
                else:
                    new_path = os.path.join(root, RENAME_TO)
                    try:
                        os.rename(full_path, new_path)
                        print(f"‚úÖ Renamed: {full_path} ‚Üí {new_path}")
                    except Exception as e:
                        print(f"‚ùå Failed to rename '{folder_name}': {e}")

    if not matching_folders:
        print(f"‚ÑπÔ∏è No folders found containing '{SEARCH_KEYWORD}'.")
    elif CHECK_ONLY:
        print(f"\nüìä Total folders found: {len(matching_folders)} (no changes made)")
    else:
        print(f"\n‚úÖ Total folders renamed: {len(matching_folders)}")


if __name__ == "__main__":
    list_or_rename_folders()