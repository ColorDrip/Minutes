from flask import Flask, request, render_template_string, redirect
import pyodbc

app = Flask(__name__)

# --- Path to your shared MS Access DB ---
db_file = r"C:\SharedDB\TeamData.accdb"

conn_str = (
    r"DRIVER={Microsoft Access Driver (*.mdb, *.accdb)};"
    f"DBQ={db_file};"
)

# --- HTML Form Template ---
HTML_FORM = """
<!doctype html>
<title>Employee Data Form</title>
<h2>Enter Employee Data</h2>
<form method="POST" action="/submit">
  Name: <input type="text" name="name" required><br><br>
  Department: <input type="text" name="department" required><br><br>
  Hours Worked: <input type="number" name="hours" required><br><br>
  <button type="submit">Submit</button>
</form>

<h2>All Records</h2>
<table border="1" cellpadding="5">
<tr><th>ID</th><th>Name</th><th>Department</th><th>Hours Worked</th></tr>
{% for row in records %}
<tr>
<td>{{row[0]}}</td>
<td>{{row[1]}}</td>
<td>{{row[2]}}</td>
<td>{{row[3]}}</td>
</tr>
{% endfor %}
</table>
"""

# --- Fetch all records from DB ---
def fetch_records():
    conn = pyodbc.connect(conn_str)
    cursor = conn.cursor()
    cursor.execute("SELECT * FROM Employees")
    rows = cursor.fetchall()
    conn.close()
    return rows

# --- Routes ---
@app.route('/', methods=['GET'])
def index():
    records = fetch_records()
    return render_template_string(HTML_FORM, records=records)

@app.route('/submit', methods=['POST'])
def submit():
    name = request.form['name']
    department = request.form['department']
    hours = request.form['hours']

    conn = pyodbc.connect(conn_str)
    cursor = conn.cursor()
    cursor.execute("INSERT INTO Employees (Name, Department, HoursWorked) VALUES (?, ?, ?)",
                   (name, department, hours))
    conn.commit()
    conn.close()

    return redirect('/')  # Go back to home page to see updated table

# --- Run the app ---
if __name__ == "__main__":
    app.run(debug=True)