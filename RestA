import socket
from office365.sharepoint.client_context import ClientContext
from office365.runtime.auth.authentication_context import AuthenticationContext

# Test basic connectivity first
def test_connectivity(hostname):
    try:
        # Test DNS resolution
        ip = socket.gethostbyname('yourtenant.sharepoint.com')
        print(f"Resolved IP: {ip}")
        return True
    except socket.gaierror as e:
        print(f"DNS resolution failed: {e}")
        return False

# Fix socket configuration
socket.setdefaulttimeout(60)  # Increase timeout

# Your SharePoint code with error handling
try:
    site_url = "https://yourtenant.sharepoint.com/sites/yoursite"
    username = "your-email@yourtenant.com"
    password = "your-password"
    
    auth_ctx = AuthenticationContext(site_url)
    if auth_ctx.acquire_token_for_user(username, password):
        ctx = ClientContext(site_url, auth_ctx)
        
        # Test with a simple request first
        web = ctx.web
        ctx.load(web)
        ctx.execute_query()
        print(f"Connected to: {web.properties['Title']}")
        
except Exception as e:
    print(f"Connection error: {e}")