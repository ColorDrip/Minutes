# ============================
# 1. Import Libraries
# ============================
import pandas as pd
import matplotlib.pyplot as plt
from statsmodels.tsa.arima.model import ARIMA
from statsmodels.tsa.seasonal import seasonal_decompose

# ============================
# 2. Load Your Data
# ============================
file_path = "your_file.csv"   # <-- replace with your file path
date_col = "Date"             # <-- replace with your date column
cost_col = "Cost"             # <-- replace with your cost column

# Load and parse date
data = pd.read_csv(file_path)
data[date_col] = pd.to_datetime(data[date_col], dayfirst=True)

# Set index and frequency to monthly
data.set_index(date_col, inplace=True)
data = data.asfreq('M')

# Fill missing values (forward fill)
data[cost_col] = data[cost_col].ffill()

# ============================
# 3. Decompose to see components (optional visualization)
# ============================
decomposition = seasonal_decompose(data[cost_col], model='additive', period=12)
decomposition.plot()
plt.show()

# ============================
# 4. Fit ARIMA Model
# ============================
# Using simple ARIMA(2,1,2); can tune later if needed
model = ARIMA(data[cost_col], order=(2,1,2))
model_fit = model.fit()

# ============================
# 5. Forecast Next 5 Years (60 Months)
# ============================
forecast_steps = 60  # 5 years monthly
forecast = model_fit.forecast(steps=forecast_steps)

# Create future date index
last_date = data.index[-1]
future_dates = pd.date_range(start=last_date + pd.offsets.MonthBegin(1), periods=forecast_steps, freq='M')
forecast.index = future_dates

# ============================
# 6. Plot Historical + Forecast
# ============================
plt.figure(figsize=(12,6))
plt.plot(data[cost_col], label='Historical Data')
plt.plot(forecast, label='Forecast (Next 5 Years)', color='red')
plt.title("Monthly Cost Forecast")
plt.legend()
plt.show()