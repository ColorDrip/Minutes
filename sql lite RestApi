from flask import Flask, request, render_template_string
import sqlite3

app = Flask(__name__)

# Path to your SQLite database (can be in shared folder if needed)
db_path = r"data.db"

# Create table if not exists
def init_db():
    conn = sqlite3.connect(db_path)
    conn.execute('''
        CREATE TABLE IF NOT EXISTS ratings (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            rating INTEGER
        )
    ''')
    conn.commit()
    conn.close()

init_db()

# HTML template (simple form + result display)
HTML_PAGE = '''
<!DOCTYPE html>
<html>
<head>
    <title>Rating Form</title>
    <style>
        body { font-family: Arial; background: #f8f8f8; text-align: center; padding: 50px; }
        form { background: white; display: inline-block; padding: 20px; border-radius: 10px; box-shadow: 0 0 10px #ccc; }
        input[type=number] { padding: 5px; width: 80px; }
        input[type=submit] { background-color: #4CAF50; color: white; border: none; padding: 8px 15px; cursor: pointer; border-radius: 5px; }
        h2 { color: #333; }
    </style>
</head>
<body>
    <h2>Submit Your Rating</h2>
    <form method="post" action="/">
        <label>Rating (1-5):</label>
        <input type="number" name="rating" min="1" max="5" required>
        <input type="submit" value="Submit">
    </form>

    {% if last_rating is not none %}
        <h3>Thank you! You submitted a rating of: <strong>{{ last_rating }}</strong></h3>
    {% endif %}
</body>
</html>
'''

@app.route('/', methods=['GET', 'POST'])
def index():
    last_rating = None
    if request.method == 'POST':
        rating = request.form.get('rating')
        conn = sqlite3.connect(db_path)
        conn.execute("INSERT INTO ratings (rating) VALUES (?)", (rating,))
        conn.commit()
        conn.close()
        last_rating = rating  # Show back to user
    return render_template_string(HTML_PAGE, last_rating=last_rating)

if __name__ == '__main__':
    app.run(debug=True)